parameters:
  preBuildValidation: false
  condition: true

steps:
- template: init-docker-linux.yml
  parameters:
    setupImageBuilder: false
    setupTestRunner: true
    condition: ${{ parameters.condition }}
- script: |
    echo "##vso[task.setvariable variable=testRunner.container]testrunner-$(Build.BuildId)-$(System.JobId)"
  displayName: Set Test Variables
  condition: and(succeeded(), ${{ parameters.condition }})
- script: >
    docker run -t -d
    -v /var/run/docker.sock:/var/run/docker.sock
    -v $(Build.ArtifactStagingDirectory):$(artifactsPath)
    -e RUNNING_TESTS_IN_CONTAINER=true 
    --name $(testRunner.container)
    $(imageNames.testRunner.withrepo)
  displayName: Start Test Runner Container
  condition: and(succeeded(), ${{ parameters.condition }})
